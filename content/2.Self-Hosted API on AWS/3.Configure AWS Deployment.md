::hero-alt
---

actions:
  - name: AWS Marketplace
    to: https://aws.amazon.com/marketplace/seller-profile?id=2bceface-f777-4fcb-a529-91c088f45034
    icon: vscode-icons:file-type-aws
#  - name: GitHub
#    variant: ghost
 #   to: https://github.com/ZTL-UwU/shadcn-docs-nuxt
#mobileRight: 'top' # 'top' | 'bottom'
---

#title
Configure Deployed Self-Hosted API

#description
How to configure Self-Hosted API deployments from the AWS Marketplace.

#right
![logo](aws-circle.png)
::

## Configure a CloudFormation Deployment

## Configure an AMI Deployment


### Start the Docker Daemon

For this process, you will need to have already launched an instance by following the [AMI Deployment guide](/self-hosted-api-on-aws/deploy-on-aws/).

::steps{level=5}

##### Find your EC2 instance in the AWS Console
You can view information about your instance in the EC2 Console Instances view. You can reach it from the EC2 Dashboard with any of these links.

![EC2 Instances menu](/pdf-toolkit-instructions/setting-up-your-ec2-instance/pdf-toolkit-self-hosted-setup-instance-step1.png/)

##### View your Instance details

Checking the box will select the instance in this view, and clicking the link will open the instance details in its own view. For this guide, weâ€™ll click the link and open the instance details in its own view.

![Highlighted instance ID in Instances view](/pdf-toolkit-instructions/setting-up-your-ec2-instance/pdf-toolkit-self-hosted-setup-instance-step2.png/)

##### Log into your Instance

::alert{type="secondary" icon="lucide:info"}
  AWS has extensive guides on connecting to EC2 instances from a variety of Operating Systems available [here](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/connect.html).
::

![Viewing the public IPv4 DNS of your instance](/pdf-toolkit-instructions/setting-up-your-ec2-instance/pdf-toolkit-self-hosted-setup-instance-step3.png)

Look for Public IPv4 DNS on the Details tab. Log onto the server using that URL, the username `ec2-user`, and the keypair you selected when creating the instance.

##### Starting the Docker server

::alert{type="secondary" icon="lucide:info"}
Official Docker documentation is located [here](https://docs.docker.com/reference/cli/docker/container/run/)
::

The following commands will start the Docker server with the default settings. Be sure to pick the command below that matches your Self-Hosted API product.
<br>
::tabs{variant="card"}
  ```bash [PDF Toolkit]
# Run the Docker container.
# -d (--detach) runs the container in the background.
# -p (--publish) binds port 3000 of the Container to port 80 of the server.
# --restart sets policy to automatically restarts the Container if it stops.
# :latest runs the most recent version of the Container available.

docker run -d -p 80:3000 --restart always pdf_toolkit_self-hosted_api:latest
  ```
  ```bash [PDF Forms Pro]
  # Run the Docker container.
# -d (--detach) runs the container in the background.
# -p (--publish) binds port 3000 of the Container to port 80 of the server.
# --restart sets policy to automatically restarts the Container if it stops.
# :latest runs the most recent version of the Container available.

docker run -d -p 80:3000 --restart always pdf_forms_pro_self-hosted_api:latest
  ```
  ```bash [PDF to Office]
# Run the Docker container.
# -d (--detach) runs the container in the background.
# -p (--publish) binds port 3000 of the Container to port 80 of the server.
# --restart sets policy to automatically restarts the Container if it stops.
# :latest runs the most recent version of the Container available.

docker run -d -p 80:3000 --restart always pdf_office_pro_self-hosted_api:latest
  ```
::


If you receive an error that the Docker daemon is not running, execute this command first:

```bash
sudo systemctl start docker
```


::

### Controlling the Container

The following commands control the Docker container:

```bash
# View the running container and retrieve it's randomly generated name.
docker ps

# Stop the Docker server.
docker stop <container_name>

# Remove the container.
docker rm <container_name>
```

![Docker commands run in a terminal](/pdf-toolkit-instructions/setting-up-your-ec2-instance/pdf-toolkit-self-hosted-setup-instance-step5.png/)


### Environment variables

Above, using the `docker run` command, we started the server using the default configuration. As shown below, there are a number options that can be customized for the pdfRest service through its environment variables. Invoke environment variables by using `-e` with the `docker run` command.

::field-group
  ::field{name="REMOVE_ORIGINAL_PROCESSED" type="integer"}
  Controls whether uploaded and processed documents are deleted from the system. Set to `1` for **true** or `2` for **false**. Defaults to `1` for **true**.
  ::
  ::field{name="REMOVE_ORIGINAL_PROCESSED_DELAY" type="integer"}
  Controls how long before those documents are deleted from the system in milliseconds. Requires `REMOVE_ORIGINAL_PROCESSED` to be `1`. Defaults to `1800000` (30 minutes).
  ::
  ::field{name="MAX_PROCESS_TIME" type="intiger"}
  Controls how long a single document will process before timing out in seconds. Defaults to `1800` (30 minutes)
  ::
  ::field{name="MAX_UPLOAD_SIZE" type="intiger"}
  Controls the maxiumum uploaded file size in MB. Defaults to `1000`.
  ::
  ::field{name="INPUT_KEY" type="string"}
  A value appended to all input file `id` UUIDs to visually and programatically identify them. Defaults to `1`.
  ::
  ::field{name="OUTPUT_KEY" type="string"}
  A value appended to all output file `id` UUIDs to visually and programatically identify them. Defaults to `2`.
  ::
  ::field{name="REDIRECT_ROOT_URL" type="string"}
  Controls the url that users will be redirected to if they try to manually navigate to the server domain. Defaults to `https://pdfrest.com`.
  ::
  ::field{name="PDFREST_SERVER_DOMAIN" type="boolean"}
  Controls which domain the pdfRest API will tell users to retrieve their files from after processing. Must be set to the scheme and host of the actual server
  ::
  ::field{name="PDFREST_MAX_CLU_CONCURRENCY" type="integer"}
  Sets the maximum number of concurrent processing requests that can run; any additional requests will enter the local queue. This prevents performance issues during batches of simultaneous requests. The default is the number of CPU cores minus 1, with a minimum of 1.
  <br><br> ex. An instance with 4 CPU cores would default to `PDFREST_MAX_CLU_CONCURRENCY` = `3`
::


#### Examples for starting server with customized configurations

```bash
# Run the pdfRest Self-Hosted API server so that processed documents
# are deleted in 30 minutes. Files are permitted to process for
# a maximum of 60 minutes.

docker run -d -p 80:3000 --restart always \
-e REMOVE_ORIGINAL_PROCESSED=1 \
-e MAX_PROCESS_TIME=3600 \
pdf_toolkit_self-hosted_api:latest
```

```bash
# Run the Forms Pro API so that processed documents are not deleted
# and the maximum uploaded file size is 10MB.

docker run -d -p 80:3000 --restart always \
-e REMOVE_ORIGINAL_PROCESSED=0 \
-e MAX_UPLOAD_SIZE=10 \
pdf_forms_pro_self-hosted_api:latest
```